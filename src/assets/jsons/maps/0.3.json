{
    "width": 7,
    "height": 7,
    "tiles": [
        {
            "type": "SPAWN",
            "d": {
                "d": 100,
                "ae": [
                    {
                        "t": "REGULAR",
                        "f": 1,
                        "l": 0
                    }
                ]
            }
        },
        {
            "type": "SOURCE",
            "x": 1,
            "d": {
                "rd": 0.4,
                "r": [
                    {
                        "t": "SCALAR",
                        "a": 100
                    }
                ]
            }
        },
        {
            "type": "ROAD",
            "y": 1
        },
        {
            "type": "SOURCE",
            "x": 4,
            "y": 1,
            "d": {
                "rd": 0.3,
                "r": [
                    {
                        "t": "SCALAR",
                        "a": 100
                    }
                ]
            }
        },
        {
            "type": "XM_MUSIC_TRACK",
            "x": 5,
            "y": 1,
            "d": {
                "id": 3,
                "track": "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"
            }
        },
        {
            "type": "ROAD",
            "y": 2
        },
        {
            "type": "PLATFORM",
            "x": 3,
            "y": 2
        },
        {
            "type": "ROAD",
            "y": 3
        },
        {
            "type": "PLATFORM",
            "x": 3,
            "y": 3
        },
        {
            "type": "ROAD",
            "y": 4
        },
        {
            "type": "ROAD",
            "y": 5
        },
        {
            "type": "ROAD",
            "x": 1,
            "y": 5
        },
        {
            "type": "SCRIPT",
            "y": 6,
            "d": {
                "id": 6898273844432340766,
                "script": "--[[\n0.3\nI18nGenerator {\n    \"tut_03_010_010_this_next_level\",\n    \"tut_03_010_020_sniper_tower_well\",\n    \"tut_03_010_030_build_sniper_tower\",\n    \"tut_03_010_040_sniper_tower_deals\",\n    \"tut_03_010_050_when_changing_target\",\n    \"tut_03_020_010_defeat_first_wave\",\n    \"tut_03_020_020_towers_gain_experience\",\n    \"tut_03_030_010_some_platforms_give\",\n    \"tut_03_030_020_check_out_this\",\n    \"tut_03_030_030_select_platform_with_bonus\",\n    \"tut_03_030_040_turn_on_detailed_mode\",\n    \"tut_03_040_010_this_platform_will_increase\",\n    \"tut_03_040_020_theres_not_enough\",\n    \"tut_03_040_030_sell_existing_tower\",\n    \"tut_03_050_010_build_sniper\",\n    \"tut_03_060_010_defeat_second_wave\",\n    \"tut_03_070_010_tower_gains_abilities\",\n    \"tut_03_070_020_your_tower_reached\",\n    \"tut_03_070_030_select_ability\",\n    \"tut_03_080_010_defeat_remaining_waves\",\n    \"tut_03_080_020_switch_game_speed\"\n}\n--]]\n\ndofile(\"scripts/utils/binder.lua\")\ndofile(\"scripts/utils/tutorial.lua\")\n\nlocal TAG = \"0.3.lua: \"\n\nlocal i18n = function() return managers.LocaleManager.i18n end\nlocal sm = function() return SP._graphics.storylineMessages end\nlocal ql = function() return SP._graphics.questList end\n\nlocal questListItem\nlocal s3_drawModeQuest\nlocal s3_tileWithBonus\n\nlocal tut\n\nlog(TAG .. \"Level 0.3 script was successfully loaded\")\n\naddEventHandler(\"SystemPostSetup\", function()\n    SP._input:setHotKeysEnabled(false)\n    SP._graphics.mainUi:hideNextWaveButton()\n    managers.UiManager:findActor(\"build_menu_modifiers_tab_button\"):setVisible(false)\n    managers.UiManager:findActor(\"tower_menu_upgrade\"):setVisible(false)\n    managers.UiManager:findActor(\"tower_menu_sell_button\"):setVisible(false)\n    SP._graphics.mainUi:showMessagesButton(false, nil)\n    SP._graphics.mainUi:hideGameSpeedButton()\n    SP._graphics.towerMenu:hideTowerExperience()\n    SP._graphics.towerMenu:hideTowerAbilities()\n    SP.achievement:setEnabled(false)\n\n    tut:start()\n\n    SP.gameState.listeners:add(luajava.createProxy(GNS .. \"systems.GameStateSystem$GameStateSystemListener\", {\n        realUpdate = function(deltaTime)\n            tut:update(deltaTime)\n        end,\n\n        affectsGameState = function() return false end\n    }))\n\n    log(TAG .. \"Started\")\nend)\n\ntut = tutorial:new({\n    {-- \u041f\u043e\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0441\u043d\u0430\u0439\u043f\u0435\u0440\n        check = function()\n            for i = 0, SP.tower.towers.size - 1 do\n                if SP.tower.towers:get(i).type == enums.TowerType.SNIPER then\n                    return true\n                end\n            end\n\n            return false\n        end,\n        start = function()\n            log(\"Stage 1 start\")\n            tut:delay(1, function()\n                sm():queue({\n                    tut.ADVINAS_TAG .. \" \" .. i18n():get(\"tut_03_010_010_this_next_level\"),\n                    tut.ADVINAS_TAG .. \" \" .. i18n():get(\"tut_03_010_020_sniper_tower_well\"),\n                })\n                sm():runOnContinue(luajava.createProxy(\"java.lang.Runnable\", {\n                    run = function()\n                        log(\"Stage 1 sm continue\")\n\n                        -- \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u043a\u0432\u0435\u0441\u0442\n                        questListItem = ql():addQuestListItem()\n                        questListItem:setText(i18n():get(\"tut_03_010_030_build_sniper_tower\"))\n\n                        -- \u041f\u043e\u0434\u0441\u0432\u0435\u0447\u0438\u0432\u0430\u0435\u043c\n                        managers.UiManager:addHighlight(managers.UiManager:findActor(\"build_menu_tower_build_button_SNIPER\"))\n                    end\n                }))\n            end)\n        end,\n        done = function()\n            log(\"Stage 1 done\")\n\n            managers.UiManager:removeAllHighlights()\n            SP.gameState:addCompletedQuest(\"Q:0.3:1\")\n\n            questListItem:setCompleted(true)\n            tut:delay(2, function()\n                ql():removeQuestListItem(questListItem)\n\n                sm():queue({\n                    tut.ADVINAS_TAG .. \" \" .. i18n():get(\"tut_03_010_040_sniper_tower_deals\"),\n                    tut.ADVINAS_TAG .. \" \" .. i18n():get(\"tut_03_010_050_when_changing_target\"),\n                })\n                sm():runOnContinue(luajava.createProxy(\"java.lang.Runnable\", {\n                    run = function()\n                        tut:startNextStage()\n                    end\n                }))\n            end)\n        end\n    },\n    {-- \u041f\u043e\u0431\u0435\u0434\u0438\u0442\u044c \u043f\u0435\u0440\u0432\u0443\u044e \u0432\u043e\u043b\u043d\u0443\n        check = function()\n            return SP.wave:getCompletedWavesCount() >= 1\n        end,\n        start = function()\n            log(\"Stage 2 start\")\n\n            -- \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u043a\u0432\u0435\u0441\u0442\n            questListItem = ql():addQuestListItem()\n            questListItem:setText(i18n():get(\"tut_03_020_010_defeat_first_wave\"))\n\n            -- \u041f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u043c \u043a\u043d\u043e\u043f\u043a\u0443 \u0432\u044b\u0437\u043e\u0432\u0430 \u0432\u043e\u043b\u043d\u044b\n            SP._graphics.mainUi:showNextWaveButton(false, nil)\n\n            -- \u041f\u043e\u0441\u043b\u0435 \u0432\u044b\u0437\u043e\u0432\u0430 \u0432\u043e\u043b\u043d\u044b \u0441\u043a\u0440\u044b\u0432\u0430\u0435\u043c \u043a\u043d\u043e\u043f\u043a\u0443\n            tut:condition(function()\n                return SP.wave.wave ~= nil\n            end,\n                    function()\n                        SP._graphics.mainUi:hideNextWaveButton()\n                    end)\n        end,\n        done = function()\n            log(\"Stage 2 done\")\n\n            questListItem:setCompleted(true)\n            tut:delay(1, function()\n                ql():removeQuestListItem(questListItem)\n\n                -- \u041f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u043c \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0431\u0430\u0448\u043d\u0438 \u0438 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u0443\u044e \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a\u0443\n                sm():queue({\n                    tut.ADVINAS_TAG .. \" \" .. i18n():get(\"tut_03_020_020_towers_gain_experience\"),\n                })\n                sm():runOnContinue(luajava.createProxy(\"java.lang.Runnable\", {\n                    run = function()\n                        -- \u041f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u043c \u043e\u043f\u044b\u0442 \u0438 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0431\u0430\u0448\u043d\u0438\n                        SP._graphics.towerMenu:showTowerExperience(true, luajava.createProxy(\"java.lang.Runnable\", {\n                            run = function()\n                                tut:startNextStage()\n                            end\n                        }))\n                    end\n                }))\n            end)\n        end\n    },\n    {-- (\u041f\u043e\u044f\u0432\u0438\u0442\u0441\u044f \u043d\u043e\u0432\u044b\u0439 \u0442\u0430\u0439\u043b \u0441 \u0431\u043e\u043d\u0443\u0441\u043e\u043c \u043e\u043f\u044b\u0442\u0430) \u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0442\u0430\u0439\u043b \u0438 \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u043d\u0435\u043c\n        check = function()\n            return SP.map:getSelectedTile() == s3_tileWithBonus and s3_tileWithBonus ~= nil\n        end,\n        start = function()\n            log(\"Stage 3 start\")\n\n            -- \u041e\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c \u0438\u0433\u0440\u0443\n            SP._graphics.mainUi:hideNextWaveButton()\n            -- SP.gameState:setGameSpeed(0)\n            SP.wave:freezeTimeToNextWave(9001)\n\n            sm():queue({\n                tut.ADVINAS_TAG .. \" \" .. i18n():get(\"tut_03_030_010_some_platforms_give\"),\n                tut.ADVINAS_TAG .. \" \" .. i18n():get(\"tut_03_030_020_check_out_this\"),\n            })\n            sm():runOnContinue(luajava.createProxy(\"java.lang.Runnable\", {\n                run = function()\n                    log(\"Stage 3 sm continue\")\n\n                    -- \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u0442\u0430\u0439\u043b\n                    s3_tileWithBonus = managers.TileManager:getFactory(enums.TileType.PLATFORM):create()\n                    s3_tileWithBonus.bonusType = enums.SpaceTileBonusType.BONUS_EXPERIENCE\n                    s3_tileWithBonus.bonusLevel = 5\n                    SP.map:setTile(4, 3, s3_tileWithBonus)\n                    SP.map:showTileWarningParticle(4, 3)\n\n                    -- \u041f\u043e\u0434\u0441\u0432\u0435\u0447\u0438\u0432\u0430\u0435\u043c \u0435\u0433\u043e\n                    SP.map:removeHighlights()\n                    SP.map:highlightTile(s3_tileWithBonus)\n\n                    -- \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u043a\u0432\u0435\u0441\u0442 \u0432\u044b\u0431\u043e\u0440\u0430 \u0442\u0430\u0439\u043b\u0430\n                    questListItem = ql():addQuestListItem()\n                    questListItem:setText(i18n():get(\"tut_03_030_030_select_platform_with_bonus\"))\n\n                    -- \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u043a\u0432\u0435\u0441\u0442 \u0441\u043c\u0435\u043d\u044b \u0440\u0435\u0436\u0438\u043c\u0430 \u043e\u0442\u0440\u0438\u0441\u043e\u0432\u043a\u0438\n                    s3_drawModeQuest = ql():addQuestListItem()\n                    s3_drawModeQuest:setText(i18n():get(\"tut_03_030_040_turn_on_detailed_mode\"))\n                    tut:condition(function()\n                        return SP._mapRendering:getDrawMode() == bind(\"systems.MapRenderingSystem$DrawMode\").DETAILED\n                    end,\n                            function()\n                                s3_drawModeQuest:setCompleted(true)\n                            end)\n                end\n            }))\n        end,\n        done = function()\n            log(\"Stage 3 done\")\n\n            SP.map:removeHighlights()\n            questListItem:setCompleted(true)\n            tut:delay(2, function()\n                ql():removeQuestListItem(questListItem)\n                ql():removeQuestListItem(s3_drawModeQuest)\n                tut:startNextStage()\n            end)\n        end\n    },\n    {-- \u041f\u0440\u043e\u0434\u0430\u0442\u044c \u043f\u0435\u0440\u0432\u044b\u0439 \u0441\u043d\u0430\u0439\u043f\u0435\u0440\n        check = function()\n            return SP.tower.towers.size == 0\n        end,\n        start = function()\n            log(\"Stage 4 start\")\n\n            sm():queue({\n                tut.ADVINAS_TAG .. \" \" .. i18n():get(\"tut_03_040_010_this_platform_will_increase\"),\n                tut.ADVINAS_TAG .. \" \" .. i18n():get(\"tut_03_040_020_theres_not_enough\")\n            })\n            sm():runOnContinue(luajava.createProxy(\"java.lang.Runnable\", {\n                run = function()\n                    log(\"Stage 4 sm continue\")\n\n                    -- \u0412\u044b\u0431\u0438\u0440\u0430\u0435\u043c \u0431\u0430\u0448\u043d\u044e\n                    local tower = SP.tower.towers:get(0)\n                    if tower ~= nil then\n                        SP.map:setSelectedTile(tower:getTile())\n                    end\n\n                    -- \u041e\u0442\u043a\u0440\u044b\u0432\u0430\u0435\u043c \u043c\u0435\u043d\u044e \u0431\u0430\u0448\u043d\u0438\n                    SP._graphics.sideMenu:setOffscreen(false)\n\n                    -- \u041f\u043e\u0434\u0441\u0432\u0435\u0447\u0438\u0432\u0430\u0435\u043c \u043a\u043d\u043e\u043f\u043a\u0443 \u043f\u0440\u043e\u0434\u0430\u0436\u0438\n                    managers.UiManager:findActor(\"tower_menu_sell_button\"):setVisible(true)\n                    managers.UiManager:addHighlight(managers.UiManager:findActor(\"tower_menu_sell_button\"))\n\n                    -- \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u043a\u0432\u0435\u0441\u0442\n                    questListItem = ql():addQuestListItem()\n                    questListItem:setText(i18n():get(\"tut_03_040_030_sell_existing_tower\"))\n                end\n            }))\n        end,\n        done = function()\n            log(\"Stage 4 done\")\n\n            managers.UiManager:removeAllHighlights()\n            questListItem:setCompleted(true)\n            tut:delay(1, function()\n                ql():removeQuestListItem(questListItem)\n                tut:startNextStage()\n            end)\n        end\n    },\n    {-- \u041f\u043e\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0441\u043d\u0430\u0439\u043f\u0435\u0440 \u043d\u0430 \u043d\u043e\u0432\u043e\u043c \u0442\u0430\u0439\u043b\u0435\n        check = function()\n            return s3_tileWithBonus.building ~= nil\n        end,\n        update = function(deltaTime)\n            if SP.gameState:getMoney() < managers.TowerManager:getFactory(enums.TowerType.SNIPER):getBuildPrice(SP) then\n                -- \u041d\u0435 \u0445\u0432\u0430\u0442\u0430\u0435\u0442 \u0434\u0435\u043d\u0435\u0433 \u043d\u0430 \u043f\u043e\u0441\u0442\u0440\u043e\u0439\u043a\u0443 \u043d\u043e\u0432\u043e\u0439 \u0431\u0430\u0448\u043d\u0438\n                SP.gameState:triggerGameOver(bind(\"systems.GameStateSystem$GameOverReason\").QUEST_FAILED)\n            end\n        end,\n        start = function()\n            log(\"Stage 5 start\")\n\n            -- \u0412\u044b\u0431\u0438\u0440\u0430\u0435\u043c \u0442\u0430\u0439\u043b\n            SP.map:setSelectedTile(s3_tileWithBonus)\n\n            -- \u041f\u043e\u0434\u0441\u0432\u0435\u0447\u0438\u0432\u0430\u0435\u043c \u0442\u0430\u0439\u043b\n            SP.map:removeHighlights()\n            SP.map:highlightTile(s3_tileWithBonus)\n\n            -- \u041f\u043e\u0434\u0441\u0432\u0435\u0447\u0438\u0432\u0430\u0435\u043c \u043a\u043d\u043e\u043f\u043a\u0443 \u043f\u043e\u0441\u0442\u0440\u043e\u0439\u043a\u0438\n            managers.UiManager:addHighlight(managers.UiManager:findActor(\"build_menu_tower_build_button_SNIPER\"))\n\n            -- \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u043a\u0432\u0435\u0441\u0442\n            questListItem = ql():addQuestListItem()\n            questListItem:setText(i18n():get(\"tut_03_050_010_build_sniper\"))\n        end,\n        done = function()\n            log(\"Stage 5 done\")\n\n            SP.map:removeHighlights()\n            questListItem:setCompleted(true)\n            tut:delay(1, function()\n                ql():removeQuestListItem(questListItem)\n                tut:startNextStage()\n            end)\n        end\n    },\n    {-- \u041f\u043e\u0431\u0435\u0434\u0438\u0442\u044c \u0432\u0442\u043e\u0440\u0443\u044e \u0432\u043e\u043b\u043d\u0443\n        check = function()\n            return SP.wave:getCompletedWavesCount() >= 2\n        end,\n        update = function(deltaTime)\n            if s3_tileWithBonus.building == nil then\n                -- \u041f\u0440\u043e\u0434\u0430\u043b\u0438 \u0431\u0430\u0448\u043d\u044e \u043d\u0430 \u0442\u0430\u0439\u043b\u0435 \u0441 \u0431\u043e\u043d\u0443\u0441\u043e\u043c\n                SP.gameState:triggerGameOver(bind(\"systems.GameStateSystem$GameOverReason\").QUEST_FAILED)\n            end\n        end,\n        start = function()\n            log(\"Stage 6 start\")\n\n            -- \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u043a\u0432\u0435\u0441\u0442\n            questListItem = ql():addQuestListItem()\n            questListItem:setText(i18n():get(\"tut_03_060_010_defeat_second_wave\"))\n\n            -- \u041f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u043c \u043a\u043d\u043e\u043f\u043a\u0443 \u0432\u044b\u0437\u043e\u0432\u0430 \u0432\u043e\u043b\u043d\u044b\n            SP._graphics.mainUi:showNextWaveButton(false, nil)\n            SP.wave:freezeTimeToNextWave(-1)\n        end,\n        done = function()\n            log(\"Stage 6 done\")\n\n            questListItem:setCompleted(true)\n            tut:delay(1, function()\n                ql():removeQuestListItem(questListItem)\n                tut:startNextStage()\n            end)\n        end\n    },\n    {-- \u0412\u044b\u0431\u0440\u0430\u0442\u044c \u043d\u0430\u0432\u044b\u043a\n        check = function()\n            if SP.tower.towers.size == 0 then return false end\n\n            local tower = SP.tower.towers:get(0)\n            if tower ~= nil then\n                for i = 1, bind(\"Tower\").ABILITIES_COUNT do\n                    if tower.installedAbilities[i] then\n                        return true\n                    end\n                end\n            end\n\n            return false\n        end,\n        update = function(deltaTime)\n            if s3_tileWithBonus.building == nil then\n                -- \u041f\u0440\u043e\u0434\u0430\u043b\u0438 \u0431\u0430\u0448\u043d\u044e \u043d\u0430 \u0442\u0430\u0439\u043b\u0435 \u0441 \u0431\u043e\u043d\u0443\u0441\u043e\u043c\n                SP.gameState:triggerGameOver(bind(\"systems.GameStateSystem$GameOverReason\").QUEST_FAILED)\n            end\n        end,\n        start = function()\n            log(\"Stage 7 start\")\n            sm():queue({\n                tut.ADVINAS_TAG .. \" \" .. i18n():get(\"tut_03_070_010_tower_gains_abilities\"),\n                tut.ADVINAS_TAG .. \" \" .. i18n():get(\"tut_03_070_020_your_tower_reached\")\n            })\n            sm():runOnContinue(luajava.createProxy(\"java.lang.Runnable\", {\n                run = function()\n                    log(\"Stage 7 sm continue\")\n\n                    -- \u041e\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c \u0432\u043e\u043b\u043d\u044b\n                    SP._graphics.mainUi:hideNextWaveButton()\n                    SP.wave:freezeTimeToNextWave(9001)\n\n                    if SP.tower.towers.size == 0 then return end -- \u041d\u0435\u0442 \u0431\u0430\u0448\u0435\u043d\n\n                    -- \u041e\u0442\u043a\u0440\u044b\u0432\u0430\u0435\u043c \u043c\u0435\u043d\u044e \u0431\u0430\u0448\u043d\u0438\n                    local tower = SP.tower.towers:get(0)\n                    if tower ~= nil then\n                        SP.map:setSelectedTile(tower:getTile())\n\n                        -- \u0415\u0441\u043b\u0438 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0431\u0430\u0448\u043d\u0438 \u043c\u0435\u043d\u044c\u0448\u0435 4, \u043f\u043e\u0434\u0433\u043e\u043d\u044f\u0435\u043c\n                        if tower:getLevel() < 4 then\n                            tower:addExperienceToMatchLevel(4)\n                        end\n                    end\n                    SP._graphics.sideMenu:setOffscreen(false)\n\n                    -- \u041f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u043c \u043a\u043d\u043e\u043f\u043a\u0438 \u043d\u0430\u0432\u044b\u043a\u043e\u0432 \u0431\u0430\u0448\u043d\u0438\n                    SP._graphics.towerMenu:showTowerAbilities(true, luajava.createProxy(\"java.lang.Runnable\", {\n                        run = function()\n                            -- \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u043a\u0432\u0435\u0441\u0442\n                            questListItem = ql():addQuestListItem()\n                            questListItem:setText(i18n():get(\"tut_03_070_030_select_ability\"))\n\n                            -- \u041f\u043e\u0434\u0441\u0432\u0435\u0447\u0438\u0432\u0430\u0435\u043c \u043a\u043d\u043e\u043f\u043a\u0438 \u043d\u0430\u0432\u044b\u043a\u043e\u0432\n                            managers.UiManager:addHighlight(managers.UiManager:findActor(\"tower_menu_abilities\"))\n                        end\n                    }))\n                end\n            }))\n        end,\n        done = function()\n            log(\"Stage 7 done\")\n\n            managers.UiManager:removeAllHighlights()\n            SP.gameState:addCompletedQuest(\"Q:0.3:2\")\n\n            questListItem:setCompleted(true)\n            tut:delay(2, function()\n                ql():removeQuestListItem(questListItem)\n                tut:startNextStage()\n            end)\n        end\n    },\n    {-- \u041f\u043e\u0431\u0435\u0434\u0438\u0442\u044c \u0442\u0440\u0435\u0442\u044c\u044e \u0432\u043e\u043b\u043d\u0443\n        check = function()\n            return false\n        end,\n        update = function(deltaTime)\n            if s3_tileWithBonus.building == nil then\n                -- \u041f\u0440\u043e\u0434\u0430\u043b\u0438 \u0431\u0430\u0448\u043d\u044e \u043d\u0430 \u0442\u0430\u0439\u043b\u0435 \u0441 \u0431\u043e\u043d\u0443\u0441\u043e\u043c\n                SP.gameState:triggerGameOver(bind(\"systems.GameStateSystem$GameOverReason\").QUEST_FAILED)\n            end\n        end,\n        start = function()\n            log(\"Stage 8 start\")\n\n            -- \u0417\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0432\u043e\u043b\u043d\u044b\n            SP._graphics.mainUi:showNextWaveButton(false, nil)\n            SP.wave:freezeTimeToNextWave(-1)\n\n            -- \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u043a\u0432\u0435\u0441\u0442\n            questListItem = ql():addQuestListItem()\n            questListItem:setText(i18n():get(\"tut_03_080_010_defeat_remaining_waves\"))\n            SP.gameState:addCompletedQuest(\"Q:0.3:3\")\n\n            -- \u0415\u0441\u043b\u0438 \u0437\u0430\u0441\u043f\u0430\u0432\u043d\u0438\u043b\u0438\u0441\u044c \u0432\u0441\u0435 \u0432\u0440\u0430\u0433\u0438 3-\u0439 \u0432\u043e\u043b\u043d\u044b, \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u043c \u043a\u043d\u043e\u043f\u043a\u0443 \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u0438 \u0438\u0433\u0440\u044b\n            tut:condition(function()\n                return (SP.wave.status ~= bind(\"systems.WaveSystem$Status\").SPAWNING) and SP.wave.wave.waveNumber >= 3\n            end, function()\n                log(\"Showing game speed button\")\n                SP._graphics.mainUi:showGameSpeedButton(true, luajava.createProxy(\"java.lang.Runnable\", {\n                    run = function()\n                        -- \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u043a\u0432\u0435\u0441\u0442\n                        local quest\n                        quest = luajava.createProxy(GNS .. \"systems.QuestSystem$Quest\", {\n                            getTitle = function()\n                                return i18n():get(\"tut_03_080_020_switch_game_speed\")\n                            end,\n\n                            update = function() end,\n\n                            isCompleted = function()\n                                return SP.gameState:getGameSpeed() > 1\n                            end,\n\n                            onCompletion = function()\n                                SP._quest:getListItem(quest):setCompleted(true)\n                            end\n                        })\n                        SP._quest:addQuest(quest)\n                    end\n                }))\n            end)\n        end,\n        done = function()\n            log(\"Stage 8 done\")\n        end\n    }\n})"
            }
        },
        {
            "type": "ROAD",
            "x": 1,
            "y": 6
        },
        {
            "type": "ROAD",
            "x": 2,
            "y": 6
        },
        {
            "type": "ROAD",
            "x": 3,
            "y": 6
        },
        {
            "type": "ROAD",
            "x": 4,
            "y": 6
        },
        {
            "type": "ROAD",
            "x": 5,
            "y": 6
        },
        {
            "type": "TARGET",
            "x": 6,
            "y": 6,
            "d": {
                "da": true,
                "usgv": true,
                "gv": [
                    {
                        "t": "STARTING_MONEY",
                        "v": 100,
                        "o": true,
                        "b": true
                    },
                    {
                        "t": "GAME_SAVES",
                        "v": 0,
                        "o": true,
                        "b": true
                    },
                    {
                        "t": "TOWERS_MAX_EXP_LEVEL",
                        "v": 4,
                        "o": true,
                        "b": true
                    },
                    {
                        "t": "TOWERS_MAX_UPGRADE_LEVEL",
                        "v": 1,
                        "o": true,
                        "b": true
                    },
                    {
                        "t": "TOWER_TYPE_BASIC",
                        "v": 0,
                        "o": true,
                        "b": true
                    },
                    {
                        "t": "TOWER_TYPE_SNIPER",
                        "v": 1,
                        "o": true,
                        "b": true
                    }
                ]
            }
        }
    ],
    "gates": []
}